# 프로젝트 핵심 요구사항 (절대 변경 금지)

이 문서는 Flutter Monitor 프로젝트의 핵심 요구사항을 기록합니다. 
**이 요구사항들은 절대 잊어버리지 말고 모든 개발 작업에서 반드시 준수해야 합니다.**

## 1. 데이터베이스 연결 설정

### 고정값 (절대 변경 금지)
- **사용자명**: `postgres` (고정, 변경 불가)
- **비밀번호**: `wkrdjqwnd` (고정, 변경 불가)
- **포트**: `5432` (기본값)

### 사용자 입력값
- **IP 주소**: PostgreSQL 서버 IP (초기 화면에서 입력)
- **데이터베이스 이름**: 데이터베이스 이름 (초기 화면에서 입력)
- **터미널 번호**: 터미널 번호 (초기 화면에서 입력, 기본값: 1)

### 연결 정보 저장
- 입력한 IP, 데이터베이스 이름, 터미널 번호는 `shared_preferences`에 저장
- **다음 실행 시 자동 로그인하지 않음** - 사용자가 수정할 수 있는 기회 제공
- 저장된 값은 초기 화면에 자동으로 채워지지만 수정 가능

## 2. 데이터베이스 쿼리

### 테이블
- 테이블명: `public.readings`

### 쿼리
```sql
SELECT rcant, rcodigo, rexp, rprecio, rtotal, id_reading
FROM public.readings
WHERE nterminal = {terminal_number}
ORDER BY id_reading;
```

### 필드 설명
- `rcant`: 수량 (int)
- `rcodigo`: 코드 (varchar)
- `rexp`: 설명 (varchar)
- `rprecio`: 가격 (float)
- `rtotal`: 총액 (float, nullable)
- `id_reading`: 읽기 ID (int)
- `nterminal`: 터미널 번호 (int) - WHERE 조건에 사용

## 3. 데이터 폴링

- **폴링 주기**: 0.1초 (100ms)마다 데이터베이스 조회
- **화면 업데이트**: **데이터가 실제로 변동되었을 때만** 화면 업데이트
  - 개수 변경 확인
  - id_reading 값 변경 확인
  - 변동이 없으면 화면 업데이트하지 않음 (성능 최적화)

## 4. 화면 레이아웃

### 전체 구조
- 작은 모니터 또는 핸드폰 수평 화면 기준
- 화면을 **세로로 절반**으로 분할

### 왼쪽 패널 (50%)
- **내용**: 모든 readings 데이터를 리스트로 표시
- **표시 필드**: rcant, rcodigo, rexp, rprecio, rtotal
- **헤더**: Qty, Code, Description, Price, Total
- **Qty와 Code 사이 간격**: 12px (가독성 향상)
- **정렬**: id_reading 순서

### 오른쪽 패널 (50%)
오른쪽 패널은 **가로로 분할**:

#### 오른쪽 상단 (4배 크기, flex: 4)
- **표시 항목**: `id_reading = 0`인 항목의 데이터
- **표시 필드**: rcant, rcodigo, rexp, rprecio, rtotal
- **폰트 크기**: 왼쪽 패널 기본 폰트(14px)의 **3배** (42px)
- **레이아웃**:
  - Qty와 Code는 **1줄로** 표시 (Row)
  - Description, Price, Total은 각각 별도 줄
- **제목 없음**: "Latest Reading" 같은 제목 표시하지 않음

#### 오른쪽 하단 (2배 크기, flex: 2)
- **내용**: 모든 rtotal 값의 합계
- **레이블**: "Importe Final"
- **표시 방식**: "Importe Final"과 숫자를 **1줄로** 표시
- **폰트 크기**: 
  - "Importe Final" 레이블: 20px
  - 숫자: 40px
- **스페인어 읽기**:
  - Importe Final이 **0이 아닐 때만** 표시
  - 숫자를 스페인어로 읽어서 표시 (소수점 이하 무시)
  - 지원 범위: 0 ~ 999,999,999
  - 폰트 크기: 32px, **bold**, **white** 색상, **dark blue** 배경
  - 전체 폭 사용, 스크롤 가능
- **QR 코드**:
  - 스페인어 텍스트 오른쪽에 배치
  - WhatsApp 메시지 전송용
  - 전화번호: `+541130123113`
  - 메시지: "Consulta de instalacion de sistema ACE III"
  - QR 코드 위에 "by ACE III" 텍스트 표시
  - 스페인어 텍스트 영역: flex 4, QR 코드 영역: flex 1

## 5. 숫자 포맷팅

### 스페인어 방식
- **천 단위 구분자**: 점 (`.`) - 예: `10.000`, `1.234.567`
- **소수점 이하**: **완전히 무시** (정수 부분만 표시)
- **정렬**: 모든 숫자는 **오른쪽 정렬**

### 예시
- `1234.56` → `1.235` (소수점 무시, 반올림)
- `10000` → `10.000`
- `999999` → `999.999`

## 6. 스페인어 숫자 읽기

### 규칙
- **소수점 이하 무시**: 정수 부분만 읽기
- **지원 범위**: 0 ~ 999,999,999
- **표시 조건**: Importe Final이 **0일 때는 표시하지 않음**
- **스타일**: 
  - 폰트 크기: 32px
  - 굵게 (bold)
  - 흰색 텍스트
  - 진한 파란색 배경
  - 전체 폭 사용
  - 스크롤 가능

### 예시
- `0` → 표시 안 함
- `123` → "ciento veintitrés"
- `1000` → "mil"
- `12345` → "doce mil trescientos cuarenta y cinco"

## 7. 테이블 초기화 처리

- readings 테이블이 **비워지면** (판매 완료):
  - 화면의 모든 내용 삭제
  - 오른쪽 하단의 "Importe Final"을 **0**으로 표시
  - 스페인어 텍스트는 표시하지 않음 (0이므로)

## 8. 로깅

- **로그 파일**: 실행할 때마다 새로운 로그 파일 생성
- **파일명 형식**: `app_YYYYMMDD_HHmmss.log`
- **저장 위치**: 사용자 Documents 디렉토리 아래 `logs/` 폴더
- **로그 형식**: `[타임스탬프] [레벨] [파일명:줄번호:컬럼번호] 메시지`
- **Git 무시**: `logs/` 폴더와 모든 `.log` 파일은 Git에서 무시

## 9. 앱 상단 표시

- **AppBar 제목**: `Terminal {번호} - {IP} - {데이터베이스이름}`
- **표시 방식**: 1줄로 큰 글씨로 표시
- **폰트 크기**: 18px, bold

## 10. 초기 데이터 로드

- 앱 시작 시 readings 테이블에 데이터가 존재하면 **즉시 표시**
- `initState()`에서 `_loadInitialData()` 호출하여 초기 데이터 로드

## 11. 코드 품질 규칙

- **가독성**: 큰 함수는 자동으로 다른 파일로 분리하고 import하여 사용
- **주요 언어**: Python, Node.js, TypeScript, JavaScript, React.js, C++

## 12. 플랫폼 지원

- **Windows**: 설치 파일 생성 가능 (Inno Setup 사용)
- **Android**: APK 빌드 가능 (Android SDK 필요)
- **iOS**: 지원 (빌드 가능)

## 변경 이력

이 문서는 프로젝트의 핵심 요구사항을 기록한 것으로, 
**이 요구사항들을 변경하려면 반드시 이 문서를 먼저 업데이트해야 합니다.**

항상 마지막 로그파일을 읽으면서 오류 분석할 것.. 
